<html><head><title>习题9: 数组和字符串</title><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="generator"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="originator"></meta><!-- index=1,2,next,fn-in,charset=utf-8,NoFonts,html --><meta content="learn-c-the-hard-way.tex" name="src"></meta><meta content="2012-04-11 11:32:00" name="date"></meta><link href="learn-c-the-hard-way.css" rel="stylesheet" type="text/css"></link></head><body>
    <!--l. 1--><div class="crosslinks"><p class="noindent">[<a href="learn-c-the-hard-waych11.html">next</a>] [<a href="learn-c-the-hard-waych9.html">prev</a>] [<a href="learn-c-the-hard-waych9.html#taillearn-c-the-hard-waych9.html">prev-tail</a>] [<a href="#taillearn-c-the-hard-waych10.html">tail</a>] [<a href="learn-c-the-hard-waypa1.html#learn-c-the-hard-waych10.html">up</a>] </p></div>
    <h2 class="chapterHead"><span class="titlemark">Chapter 10</span><br><a id="x15-5000010"></a>习题9: 数组和字符串</h2>
<!--l. 3--><p class="noindent">在上一个习题中我们学习了如何创建基本数组以及数组和字符串的对应关系。这个习题中我们将更全面的了解数组与字符串之间的相似之处，并更多地了解关于内存分布的知识。
<!--l. 5--></p><p class="indent">    这节习题展示给你的是 C 语言将字符串作为字节数组存放的，该数组以 <span class="obeylines-h"><span class="verb">’\0’</span></span>
(nul)作为终止。在上一习题中我们是手动这样去做的，所以你可能已经得出这个结论了。这里我们将用另一种方式更清晰地去展示这一点，将字符串与一个数字数组相比较：
                                                                  

                                                                  
<!--l. 7--></p><p class="indent">    <a id="x15-50001r27"></a></p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
<div class="caption"><span class="id">Source 27: </span><span class="content">                                                                                                              ex9.c</span></div><!--tex4ht:label?: x15-50001r27 -->
<div class="fancyvrb" id="fancyvrb9"><a id="x15-50003r1"></a>1  <span id="textcolor402">#</span><span id="textcolor403">include <stdio.h></stdio.h></span><br class="fancyvrb"><a id="x15-50005r2"></a>2  <br class="fancyvrb"><a id="x15-50007r3"></a>3  <span id="textcolor404">int</span> <span id="textcolor405">main</span>(<span id="textcolor406">int</span> argc, <span id="textcolor407">char</span> ⋆argv[])<br class="fancyvrb"><a id="x15-50009r4"></a>4  {
<br class="fancyvrb"><a id="x15-50011r5"></a>5      <span id="textcolor408">int</span> numbers[<span id="textcolor409">4</span>] = {<span id="textcolor410">0</span>};<br class="fancyvrb"><a id="x15-50013r6"></a>6      <span id="textcolor411">char</span> name[<span id="textcolor412">4</span>] = {<span class="colorbox" id="colorbox413"><span id="textcolor414">’a’</span></span>};<br class="fancyvrb"><a id="x15-50015r7"></a>7  
<br class="fancyvrb"><a id="x15-50017r8"></a>8      <span id="textcolor415">// first, print them out raw</span><br class="fancyvrb"><a id="x15-50019r9"></a>9      printf(<span class="colorbox" id="colorbox416"><span id="textcolor417">"</span></span><span class="colorbox" id="colorbox418"><span id="textcolor419">numbers: %d %d %d %d</span></span><span class="colorbox" id="colorbox420"><span id="textcolor421">\n</span></span><span class="colorbox" id="colorbox422"><span id="textcolor423">"</span></span>,
<br class="fancyvrb"><a id="x15-50021r10"></a>10              numbers[<span id="textcolor424">0</span>], numbers[<span id="textcolor425">1</span>],<br class="fancyvrb"><a id="x15-50023r11"></a>11              numbers[<span id="textcolor426">2</span>], numbers[<span id="textcolor427">3</span>]);
<br class="fancyvrb"><a id="x15-50025r12"></a>12  <br class="fancyvrb"><a id="x15-50027r13"></a>13      printf(<span class="colorbox" id="colorbox428"><span id="textcolor429">"</span></span><span class="colorbox" id="colorbox430"><span id="textcolor431">name each: %c %c %c %c</span></span><span class="colorbox" id="colorbox432"><span id="textcolor433">\n</span></span><span class="colorbox" id="colorbox434"><span id="textcolor435">"</span></span>,<br class="fancyvrb"><a id="x15-50029r14"></a>14              name[<span id="textcolor436">0</span>], name[<span id="textcolor437">1</span>],
<br class="fancyvrb"><a id="x15-50031r15"></a>15              name[<span id="textcolor438">2</span>], name[<span id="textcolor439">3</span>]);<br class="fancyvrb"><a id="x15-50033r16"></a>16  <br class="fancyvrb"><a id="x15-50035r17"></a>17      printf(<span class="colorbox" id="colorbox440"><span id="textcolor441">"</span></span><span class="colorbox" id="colorbox442"><span id="textcolor443">name: %s</span></span><span class="colorbox" id="colorbox444"><span id="textcolor445">\n</span></span><span class="colorbox" id="colorbox446"><span id="textcolor447">"</span></span>, name);<br class="fancyvrb"><a id="x15-50037r18"></a>18  
<br class="fancyvrb"><a id="x15-50039r19"></a>19      <span id="textcolor448">// setup the numbers</span><br class="fancyvrb"><a id="x15-50041r20"></a>20      numbers[<span id="textcolor449">0</span>] = <span id="textcolor450">1</span>;<br class="fancyvrb"><a id="x15-50043r21"></a>21      numbers[<span id="textcolor451">1</span>] = <span id="textcolor452">2</span>;
<br class="fancyvrb"><a id="x15-50045r22"></a>22      numbers[<span id="textcolor453">2</span>] = <span id="textcolor454">3</span>;<br class="fancyvrb"><a id="x15-50047r23"></a>23      numbers[<span id="textcolor455">3</span>] = <span id="textcolor456">4</span>;<br class="fancyvrb"><a id="x15-50049r24"></a>24  <br class="fancyvrb"><a id="x15-50051r25"></a>25      <span id="textcolor457">// setup the name</span>
<br class="fancyvrb"><a id="x15-50053r26"></a>26      name[<span id="textcolor458">0</span>] = <span class="colorbox" id="colorbox459"><span id="textcolor460">’Z’</span></span>;<br class="fancyvrb"><a id="x15-50055r27"></a>27      name[<span id="textcolor461">1</span>] = <span class="colorbox" id="colorbox462"><span id="textcolor463">’e’</span></span>;<br class="fancyvrb"><a id="x15-50057r28"></a>28      name[<span id="textcolor464">2</span>] = <span class="colorbox" id="colorbox465"><span id="textcolor466">’d’</span></span>;<br class="fancyvrb"><a id="x15-50059r29"></a>29      name[<span id="textcolor467">3</span>] = <span class="colorbox" id="colorbox468"><span id="textcolor469">’\0’</span></span>;
<br class="fancyvrb"><a id="x15-50061r30"></a>30  <br class="fancyvrb"><a id="x15-50063r31"></a>31      <span id="textcolor470">// then print them out initialized</span><br class="fancyvrb"><a id="x15-50065r32"></a>32      printf(<span class="colorbox" id="colorbox471"><span id="textcolor472">"</span></span><span class="colorbox" id="colorbox473"><span id="textcolor474">numbers: %d %d %d %d</span></span><span class="colorbox" id="colorbox475"><span id="textcolor476">\n</span></span><span class="colorbox" id="colorbox477"><span id="textcolor478">"</span></span>,
<br class="fancyvrb"><a id="x15-50067r33"></a>33              numbers[<span id="textcolor479">0</span>], numbers[<span id="textcolor480">1</span>],<br class="fancyvrb"><a id="x15-50069r34"></a>34              numbers[<span id="textcolor481">2</span>], numbers[<span id="textcolor482">3</span>]);
<br class="fancyvrb"><a id="x15-50071r35"></a>35  <br class="fancyvrb"><a id="x15-50073r36"></a>36      printf(<span class="colorbox" id="colorbox483"><span id="textcolor484">"</span></span><span class="colorbox" id="colorbox485"><span id="textcolor486">name each: %c %c %c %c</span></span><span class="colorbox" id="colorbox487"><span id="textcolor488">\n</span></span><span class="colorbox" id="colorbox489"><span id="textcolor490">"</span></span>,<br class="fancyvrb"><a id="x15-50075r37"></a>37              name[<span id="textcolor491">0</span>], name[<span id="textcolor492">1</span>],
<br class="fancyvrb"><a id="x15-50077r38"></a>38              name[<span id="textcolor493">2</span>], name[<span id="textcolor494">3</span>]);<br class="fancyvrb"><a id="x15-50079r39"></a>39  <br class="fancyvrb"><a id="x15-50081r40"></a>40      <span id="textcolor495">// print the name like a string</span>
<br class="fancyvrb"><a id="x15-50083r41"></a>41      printf(<span class="colorbox" id="colorbox496"><span id="textcolor497">"</span></span><span class="colorbox" id="colorbox498"><span id="textcolor499">name: %s</span></span><span class="colorbox" id="colorbox500"><span id="textcolor501">\n</span></span><span class="colorbox" id="colorbox502"><span id="textcolor503">"</span></span>, name);<br class="fancyvrb"><a id="x15-50085r42"></a>42  <br class="fancyvrb"><a id="x15-50087r43"></a>43      <span id="textcolor504">// another way to use name</span>
<br class="fancyvrb"><a id="x15-50089r44"></a>44      <span id="textcolor505">char</span> ⋆another = <span class="colorbox" id="colorbox506"><span id="textcolor507">"</span></span><span class="colorbox" id="colorbox508"><span id="textcolor509">Zed</span></span><span class="colorbox" id="colorbox510"><span id="textcolor511">"</span></span>;<br class="fancyvrb"><a id="x15-50091r45"></a>45  <br class="fancyvrb"><a id="x15-50093r46"></a>46      printf(<span class="colorbox" id="colorbox512"><span id="textcolor513">"</span></span><span class="colorbox" id="colorbox514"><span id="textcolor515">another: %s</span></span><span class="colorbox" id="colorbox516"><span id="textcolor517">\n</span></span><span class="colorbox" id="colorbox518"><span id="textcolor519">"</span></span>, another);<br class="fancyvrb"><a id="x15-50095r47"></a>47  
<br class="fancyvrb"><a id="x15-50097r48"></a>48      printf(<span class="colorbox" id="colorbox520"><span id="textcolor521">"</span></span><span class="colorbox" id="colorbox522"><span id="textcolor523">another each: %c %c %c %c</span></span><span class="colorbox" id="colorbox524"><span id="textcolor525">\n</span></span><span class="colorbox" id="colorbox526"><span id="textcolor527">"</span></span>,<br class="fancyvrb"><a id="x15-50099r49"></a>49              another[<span id="textcolor528">0</span>], another[<span id="textcolor529">1</span>],
<br class="fancyvrb"><a id="x15-50101r50"></a>50              another[<span id="textcolor530">2</span>], another[<span id="textcolor531">3</span>]);<br class="fancyvrb"><a id="x15-50103r51"></a>51  <br class="fancyvrb"><a id="x15-50105r52"></a>52      <span id="textcolor532">return</span> <span id="textcolor533">0</span>;<br class="fancyvrb"><a id="x15-50107r53"></a>53  }</div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><!--l. 66--><p class="indent">    在这段代码中我们建立了一些数组，用的是对每一个元素一一赋值这种无聊乏味的方法。在 numbers 我们是在创建一些数值，但在 name 中我们实际上是在手动创建字符串。
    </p><h3 class="sectionHead"><span class="titlemark">10.1    </span> <a id="x15-5100010.1"></a>你应该看到的结果</h3>
<!--l. 71--><p class="noindent">运行这段代码，你应该看到数组的内容被打印出来。首先打印出来的是初始为 0 的内容，接着打印出来的是初始化后的内容。
                                                                  

                                                                  
<!--l. 73--></p><p class="indent">    <a id="x15-51001r28"></a></p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
<div class="caption"><span class="id">Source 28: </span><span class="content">                                                                                                        ex9 的输出</span></div><!--tex4ht:label?: x15-51001r28 -->
<!--l. 74-->
<div class="lstlisting" id="listing-20"><span class="label"><a id="x15-51002r1"></a>1</span>$ make ex9 <br><span class="label"><a id="x15-51003r2"></a>2</span>cc -Wall -g    ex9.c   -o ex9 <br><span class="label"><a id="x15-51004r3"></a>3</span>$ ./ex9 <br><span class="label"><a id="x15-51005r4"></a>4</span>numbers: 0 0 0 0 <br><span class="label"><a id="x15-51006r5"></a>5</span>name each: a <br><span class="label"><a id="x15-51007r6"></a>6</span>name: a <br><span class="label"><a id="x15-51008r7"></a>7</span>numbers: 1 2 3 4 <br><span class="label"><a id="x15-51009r8"></a>8</span>name each: Z e d <br><span class="label"><a id="x15-51010r9"></a>9</span>name: Zed <br><span class="label"><a id="x15-51011r10"></a>10</span>another: Zed <br><span class="label"><a id="x15-51012r11"></a>11</span>another: Z e d <br><span class="label"><a id="x15-51013r12"></a>12</span>$
</div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><!--l. 91--><p class="indent">    关于这个程序，你将注意到以下几点有趣的事：
     </p><ol class="enumerate1"><li class="enumerate" id="x15-51017x1">初始化数组的时候，我并不需要将 4 个元素一一赋予数组。这是 C 语言的一个快捷功能：当你只设置了一个元素的值，它就会把剩下的都初始化为 0。
     </li>
     <li class="enumerate" id="x15-51019x2">打印 numbers 中的每一个元素时，打印出来的值都是 0。
     </li>
     <li class="enumerate" id="x15-51021x3">打印 name 中的每一个元素时，只有第一个元素’a’ 被打印出来了，因为 <span class="obeylines-h"><span class="verb">’\0’</span></span>这个特殊字符是不会被显示出来的。
     </li>
     <li class="enumerate" id="x15-51023x4">第一次打印 name 这个数组（字符串）的时候，它只输出了“a”。由于这个数组在第一个元素“a”之后的其它元素都是被 0 填充的，所以这个字符串正确地使用了 <span class="obeylines-h"><span class="verb">’\0’</span></span>作为终结字符。
     </li>
     <li class="enumerate" id="x15-51025x5">接下来我们再次创建数组，用的还是最单调乏味的手动一一赋值的方法，
     然后再次将它们打印出来。看看结果有什么变化。现在数字设置是生效了，不过你有没有看到我的名字也被正确地打印出来了？
     </li>
     <li class="enumerate" id="x15-51027x6">处理字符串有两种语法：第 6 行的 <span class="obeylines-h"><span class="verb">char name[4] = {’a’}</span></span> 和第 44 行的 <span class="obeylines-h"><span class="verb">char ⋆another = name</span></span> 。第一种不太常用，第二种才是你在处理这样的字符串常值(string literal)时应该使用的语法。</li></ol><!--l. 102--><p class="indent">    注意，我使用了完全一样的语法和代码风格来操作整数数组和字符数组进行，但是 printf 认为 name 只是一个字符串。这里再次解释一下，这是因为对于 C 语言来说，字符串和字符数组时是没有区别的。
<!--l. 104--></p><p class="indent">    最后一点，当你创建字符串时，你一般应该使用 <span class="obeylines-h"><span class="verb">char ⋆another = "Literal"</span></span>
这样的语法。这其实和前面的方法是一回事，只不过这样写更符合习惯，而且写起来更容易而已。
                                                                  

                                                                  
    </p><h3 class="sectionHead"><span class="titlemark">10.2    </span> <a id="x15-5200010.2"></a>让程序出错</h3>
<!--l. 109--><p class="noindent">几乎所有的 C 程序的 bug 都来自两个地方，一是没有分配足够的空间，二是字符串的结尾没有放 <span class="obeylines-h"><span class="verb">’\0’</span></span>。事实上这些 bug 及其常见而且很难弄对，以至于大部分高质量的 C
代码都会避免使用 C 风格的字符串。后面的习题中我们将学到如何完全避免使用 C 语言的字符串。
<!--l. 113--></p><p class="indent">    对本节的程序而言，让它出错的关键方法就是忘记在字符串结尾放 <span class="obeylines-h"><span class="verb">’\0’</span></span>。试一下下面的方法：
<!--l. 115--></p><p class="indent">
     </p><ol class="enumerate1"><li class="enumerate" id="x15-52002x1">取消 name 的初始设定。
     </li>
     <li class="enumerate" id="x15-52004x2">不小心设了 <span class="obeylines-h"><span class="verb">name[3] = ’A’;</span></span>，这样一来就没有终止符了.
     </li>
     <li class="enumerate" id="x15-52006x3">将初始值设为 <span class="obeylines-h"><span class="verb">{’a’,’a’,’a’,’a’}</span></span> ，这样就会字符’a’  过多而终止符 <span class="obeylines-h"><span class="verb">’\0’</span></span>没地方放了.</li></ol><!--l. 121--><p class="indent">    想想还有没有其他弄坏它的办法，并且就像之前一样，将它们通通放在 Valgrind
下运行，这样你就会知道到底发生了什么以及各种错误的名字。有时候你的错误连 Valgrind 都找不出来，但是你可以试变更一下申明变量的位置然后看会不会遇到错误。这也是 C 语言歪门邪道的地方，有时候你只不过动了一下变量的位置，bug 就奇怪地不见了。
<!--l. 123--></p><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">10.3    </span> <a id="x15-5300010.3"></a>加分习题</h3>
<!--l. 125--><p class="noindent">
     </p><ol class="enumerate1"><li class="enumerate" id="x15-53002x1">将字符赋值给 numbers，并使用 printf 将字符逐一的打印输出。看看你会得到什么样的编译器警告？
                                                                  

                                                                  
     </li>
     <li class="enumerate" id="x15-53004x2">反过来处理一下 name, 试着像操作 int 数组一样，并逐一打印(int) 值。
     Valgrind 是怎样认为的？
     </li>
     <li class="enumerate" id="x15-53006x3">你还可以用多少种其他方式来打印输出它们？
     </li>
     <li class="enumerate" id="x15-53008x4">如果一个字符数组的长度是 4 个字节，一个整数的长度也是 4 个字节，你可以把整个 name 数组当做一个整数来处理吗？你要通过怎样的手段才能做到这一点？
     </li>
     <li class="enumerate" id="x15-53010x5">在纸上把数组画出来，用一排盒子的格式表示出这些数组。然后将你上面的操作在纸上模拟出来，看看你是否弄对了。
     </li>
     <li class="enumerate" id="x15-53012x6">将 name 用 another 的申明风格申明一次，看看代码是否还能正常运行。
     </li></ol><!--l. 1--><div class="crosslinks"><p class="noindent">[<a href="learn-c-the-hard-waych11.html">next</a>] [<a href="learn-c-the-hard-waych9.html">prev</a>] [<a href="learn-c-the-hard-waych9.html#taillearn-c-the-hard-waych9.html">prev-tail</a>] [<a href="learn-c-the-hard-waych10.html">front</a>] [<a href="learn-c-the-hard-waypa1.html#learn-c-the-hard-waych10.html">up</a>] </p></div>
<!--l. 1--><p class="indent">    <a id="taillearn-c-the-hard-waych10.html"></a>   
</p></body></html>