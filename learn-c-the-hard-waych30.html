<html><head><title>Exercise 29: Libraries And Linking</title><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="generator"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="originator"></meta><!-- index=1,2,next,fn-in,charset=utf-8,NoFonts,html --><meta content="learn-c-the-hard-way.tex" name="src"></meta><meta content="2012-04-11 11:32:00" name="date"></meta><link href="learn-c-the-hard-way.css" rel="stylesheet" type="text/css"></link></head><body>
    <!--l. 1--><div class="crosslinks"><p class="noindent">[<a href="learn-c-the-hard-waych31.html">next</a>] [<a href="learn-c-the-hard-waych29.html">prev</a>] [<a href="learn-c-the-hard-waych29.html#taillearn-c-the-hard-waych29.html">prev-tail</a>] [<a href="#taillearn-c-the-hard-waych30.html">tail</a>] [<a href="learn-c-the-hard-waypa2.html#learn-c-the-hard-waych30.html">up</a>] </p></div>
    <h2 class="chapterHead"><span class="titlemark">Chapter 30</span><br><a id="x36-19300030"></a>Exercise 29: Libraries And Linking</h2>
<!--l. 3--><p class="noindent">A central part of any C program is the ability to link it to libraries that your
operating system provides. Linking is how you get additional features for your
program that someone else created and packaged on the system. You’ve been using
some standard libraries that are automatically included, but I’m going to explain the
different types of libraries and what they do.
<!--l. 9--></p><p class="indent">    First off, libraries are poorly designed in every programming language. I have
no idea why, but it seems language designers think of linking as something they just
slap on later. They are usually confusing, hard to deal with, can’t do versioning right,
and end up being linked differently everywhere.
<!--l. 14--></p><p class="indent">    C is no different, but the way linking and libraries are done in C is an artifact of
how the Unix operating system and executable formats were designed years ago.
Learning how C links things helps you understand how your OS works and how it
runs your programs.
<!--l. 19--></p><p class="indent">    To start off there are two basic types of libraries:
     </p><dl class="description"><dt class="description">
static </dt><dd class="description">You’ve made one of these when you used ar and ranlib to creat the
     libYOUR_LIBRARY.a in the last exercise. This kind of library is nothing
     more than a container for a set of .o object files and their functions, and
     you can treat it like one big .o file when building your programs.
     </dd><dt class="description">
dynamic </dt><dd class="description">These typically end in .so, .dll or about 1 million other endings
     on OSX depending on the version and who happened to be working that
     day. Seriously though, OSX adds .dylib, .bundle, and .framework
     with  not  much  distinction  between  the  three.  These  files  are  built  and
     then placed in a common location. When you run your program the OS
     dynamically loades these files and links them to your program on the fly.</dd></dl><!--l. 34--><p class="indent">    I tend to like static libraries for small to medium sized projects because they are
easier to deal with and work on more operating systems. I also like to put all of the
                                                                  

                                                                  
code I can into a static library so that I can then link it to unit tests and to the file
programs as needed.
<!--l. 39--></p><p class="indent">    Dynamic libraries are good for larger systems, when space is tight, or if you
have a large number of programs that use common functionality. In this case you
don’t want to statically link all of the code for the common features to every
program, so you put it in a dynamic library so that it is loaded only once for all of
them.
<!--l. 44--></p><p class="indent">    In the previous exercise I laid out how to make a static library (a .a file), and
that’s what I’ll use in the rest of the book. In this exercise I’m going to show you how
to make a simple .so library, and how to dynamically load it with the Unix dlopen
system. I’ll have you do this manually so that you understand everything that’s
actually happening, then the Extra Credit will be to use the c-skeleton skeleton to
create it.
    </p><h4 class="subsectionHead"><span class="titlemark">30.0.1    </span> <a id="x36-19400030.0.1"></a>Dynamically Loading A Shared Library</h4>
<!--l. 53--><p class="noindent">To do this I will create two source files. One will be used to make a libex29.so
library, the other will be a program called ex29 that can load this library and run
functions from it.
                                                                  

                                                                  
<!--l. 57--></p><p class="indent">    <a id="x36-194001r82"></a></p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
 <div class="caption"><span class="id">Source 82: </span><span class="content">                                                                                                        libex29.c</span></div><!--tex4ht:label?: x36-194001r82 -->
<div class="fancyvrb" id="fancyvrb49"><a id="x36-194003r1"></a>1  <span id="textcolor4479">#</span><span id="textcolor4480">include <stdio.h></stdio.h></span><br class="fancyvrb"><a id="x36-194005r2"></a>2  <span id="textcolor4481">#</span><span id="textcolor4482">include <ctype.h></ctype.h></span><br class="fancyvrb"><a id="x36-194007r3"></a>3  <span id="textcolor4483">#</span><span id="textcolor4484">include "dbg.h"</span><br class="fancyvrb"><a id="x36-194009r4"></a>4  <br class="fancyvrb"><a id="x36-194011r5"></a>5  
<br class="fancyvrb"><a id="x36-194013r6"></a>6  <span id="textcolor4485">int</span> <span id="textcolor4486">print_a_message</span>(<span id="textcolor4487">const</span> <span id="textcolor4488">char</span> ⋆msg)<br class="fancyvrb"><a id="x36-194015r7"></a>7  {<br class="fancyvrb"><a id="x36-194017r8"></a>8      printf(<span class="colorbox" id="colorbox4489"><span id="textcolor4490">"</span></span><span class="colorbox" id="colorbox4491"><span id="textcolor4492">A STRING: %s</span></span><span class="colorbox" id="colorbox4493"><span id="textcolor4494">\n</span></span><span class="colorbox" id="colorbox4495"><span id="textcolor4496">"</span></span>, msg);
<br class="fancyvrb"><a id="x36-194019r9"></a>9  <br class="fancyvrb"><a id="x36-194021r10"></a>10      <span id="textcolor4497">return</span> <span id="textcolor4498">0</span>;<br class="fancyvrb"><a id="x36-194023r11"></a>11  }<br class="fancyvrb"><a id="x36-194025r12"></a>12  <br class="fancyvrb"><a id="x36-194027r13"></a>13  <br class="fancyvrb"><a id="x36-194029r14"></a>14  <span id="textcolor4499">int</span> <span id="textcolor4500">uppercase</span>(<span id="textcolor4501">const</span> <span id="textcolor4502">char</span> ⋆msg)<br class="fancyvrb"><a id="x36-194031r15"></a>15  {<br class="fancyvrb"><a id="x36-194033r16"></a>16      <span id="textcolor4503">int</span> i = <span id="textcolor4504">0</span>;<br class="fancyvrb"><a id="x36-194035r17"></a>17  
<br class="fancyvrb"><a id="x36-194037r18"></a>18      <span id="textcolor4505">// BUG: \0 termination problems</span><br class="fancyvrb"><a id="x36-194039r19"></a>19      <span id="textcolor4506">for</span>(i = <span id="textcolor4507">0</span>; msg[i] != <span class="colorbox" id="colorbox4508"><span id="textcolor4509">’\0’</span></span>; i++) {
<br class="fancyvrb"><a id="x36-194041r20"></a>20          printf(<span class="colorbox" id="colorbox4510"><span id="textcolor4511">"</span></span><span class="colorbox" id="colorbox4512"><span id="textcolor4513">%c</span></span><span class="colorbox" id="colorbox4514"><span id="textcolor4515">"</span></span>, toupper(msg[i]));<br class="fancyvrb"><a id="x36-194043r21"></a>21      }<br class="fancyvrb"><a id="x36-194045r22"></a>22  <br class="fancyvrb"><a id="x36-194047r23"></a>23      printf(<span class="colorbox" id="colorbox4516"><span id="textcolor4517">"</span></span><span class="colorbox" id="colorbox4518"><span id="textcolor4519">\n</span></span><span class="colorbox" id="colorbox4520"><span id="textcolor4521">"</span></span>);<br class="fancyvrb"><a id="x36-194049r24"></a>24  
<br class="fancyvrb"><a id="x36-194051r25"></a>25      <span id="textcolor4522">return</span> <span id="textcolor4523">0</span>;<br class="fancyvrb"><a id="x36-194053r26"></a>26  }<br class="fancyvrb"><a id="x36-194055r27"></a>27  <br class="fancyvrb"><a id="x36-194057r28"></a>28  <span id="textcolor4524">int</span> <span id="textcolor4525">lowercase</span>(<span id="textcolor4526">const</span> <span id="textcolor4527">char</span> ⋆msg)<br class="fancyvrb"><a id="x36-194059r29"></a>29  {<br class="fancyvrb"><a id="x36-194061r30"></a>30      <span id="textcolor4528">int</span> i = <span id="textcolor4529">0</span>;<br class="fancyvrb"><a id="x36-194063r31"></a>31  
<br class="fancyvrb"><a id="x36-194065r32"></a>32      <span id="textcolor4530">// BUG: \0 termination problems</span><br class="fancyvrb"><a id="x36-194067r33"></a>33      <span id="textcolor4531">for</span>(i = <span id="textcolor4532">0</span>; msg[i] != <span class="colorbox" id="colorbox4533"><span id="textcolor4534">’\0’</span></span>; i++) {
<br class="fancyvrb"><a id="x36-194069r34"></a>34          printf(<span class="colorbox" id="colorbox4535"><span id="textcolor4536">"</span></span><span class="colorbox" id="colorbox4537"><span id="textcolor4538">%c</span></span><span class="colorbox" id="colorbox4539"><span id="textcolor4540">"</span></span>, tolower(msg[i]));<br class="fancyvrb"><a id="x36-194071r35"></a>35      }<br class="fancyvrb"><a id="x36-194073r36"></a>36  <br class="fancyvrb"><a id="x36-194075r37"></a>37      printf(<span class="colorbox" id="colorbox4541"><span id="textcolor4542">"</span></span><span class="colorbox" id="colorbox4543"><span id="textcolor4544">\n</span></span><span class="colorbox" id="colorbox4545"><span id="textcolor4546">"</span></span>);<br class="fancyvrb"><a id="x36-194077r38"></a>38  
<br class="fancyvrb"><a id="x36-194079r39"></a>39      <span id="textcolor4547">return</span> <span id="textcolor4548">0</span>;<br class="fancyvrb"><a id="x36-194081r40"></a>40  }<br class="fancyvrb"><a id="x36-194083r41"></a>41  <br class="fancyvrb"><a id="x36-194085r42"></a>42  <span id="textcolor4549">int</span> <span id="textcolor4550">fail_on_purpose</span>(<span id="textcolor4551">const</span> <span id="textcolor4552">char</span> ⋆msg)<br class="fancyvrb"><a id="x36-194087r43"></a>43  {<br class="fancyvrb"><a id="x36-194089r44"></a>44      <span id="textcolor4553">return</span> <span id="textcolor4554">1</span>;<br class="fancyvrb"><a id="x36-194091r45"></a>45  }</div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><!--l. 108--><p class="indent">    There’s nothing fancy in there, although there’s some bugs I’m leaving in on
purpose to see if you’ve been paying attention. You’ll fix those later.
<!--l. 111--></p><p class="indent">    What we want to do is use the functions dlopen, dlsym and dlclose to work
with the above functions.
                                                                  

                                                                  
<!--l. 114--></p><p class="indent">    <a id="x36-194092r83"></a></p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
 <div class="caption"><span class="id">Source 83: </span><span class="content">                                                                                                            ex29.c</span></div><!--tex4ht:label?: x36-194092r83 -->
<div class="fancyvrb" id="fancyvrb50"><a id="x36-194094r1"></a>1  <span id="textcolor4555">#</span><span id="textcolor4556">include <stdio.h></stdio.h></span><br class="fancyvrb"><a id="x36-194096r2"></a>2  <span id="textcolor4557">#</span><span id="textcolor4558">include "dbg.h"</span><br class="fancyvrb"><a id="x36-194098r3"></a>3  <span id="textcolor4559">#</span><span id="textcolor4560">include <dlfcn.h></dlfcn.h></span><br class="fancyvrb"><a id="x36-194100r4"></a>4  
<br class="fancyvrb"><a id="x36-194102r5"></a>5  <span id="textcolor4561">typedef</span> <span id="textcolor4562">int</span> (⋆lib_function)(<span id="textcolor4563">const</span> <span id="textcolor4564">char</span> ⋆data);<br class="fancyvrb"><a id="x36-194104r6"></a>6  <br class="fancyvrb"><a id="x36-194106r7"></a>7  <br class="fancyvrb"><a id="x36-194108r8"></a>8  <span id="textcolor4565">int</span> <span id="textcolor4566">main</span>(<span id="textcolor4567">int</span> argc, <span id="textcolor4568">char</span> ⋆argv[])
<br class="fancyvrb"><a id="x36-194110r9"></a>9  {<br class="fancyvrb"><a id="x36-194112r10"></a>10      <span id="textcolor4569">int</span> rc = <span id="textcolor4570">0</span>;<br class="fancyvrb"><a id="x36-194114r11"></a>11      check(argc == <span id="textcolor4571">4</span>, <span class="colorbox" id="colorbox4572"><span id="textcolor4573">"</span></span><span class="colorbox" id="colorbox4574"><span id="textcolor4575">USAGE: ex29 libex29.so function data</span></span><span class="colorbox" id="colorbox4576"><span id="textcolor4577">"</span></span>);
<br class="fancyvrb"><a id="x36-194116r12"></a>12  <br class="fancyvrb"><a id="x36-194118r13"></a>13      <span id="textcolor4578">char</span> ⋆lib_file = argv[<span id="textcolor4579">1</span>];<br class="fancyvrb"><a id="x36-194120r14"></a>14      <span id="textcolor4580">char</span> ⋆func_to_run = argv[<span id="textcolor4581">2</span>];
<br class="fancyvrb"><a id="x36-194122r15"></a>15      <span id="textcolor4582">char</span> ⋆data = argv[<span id="textcolor4583">3</span>];<br class="fancyvrb"><a id="x36-194124r16"></a>16  <br class="fancyvrb"><a id="x36-194126r17"></a>17      <span id="textcolor4584">void</span> ⋆lib = dlopen(lib_file, RTLD_NOW);
<br class="fancyvrb"><a id="x36-194128r18"></a>18      check(lib != <span id="textcolor4585">NULL</span>, <span class="colorbox" id="colorbox4586"><span id="textcolor4587">"</span></span><span class="colorbox" id="colorbox4588"><span id="textcolor4589">Failed to open the library %s: %s</span></span><span class="colorbox" id="colorbox4590"><span id="textcolor4591">"</span></span>, lib_file, dlerror());
<br class="fancyvrb"><a id="x36-194130r19"></a>19  <br class="fancyvrb"><a id="x36-194132r20"></a>20      lib_function func = dlsym(lib, func_to_run);
<br class="fancyvrb"><a id="x36-194134r21"></a>21      check(func != <span id="textcolor4592">NULL</span>, <span class="colorbox" id="colorbox4593"><span id="textcolor4594">"</span></span><span class="colorbox" id="colorbox4595"><span id="textcolor4596">Did not find %s function in the library %s: %s</span></span><span class="colorbox" id="colorbox4597"><span id="textcolor4598">"</span></span>, func_to_run, lib_file, dlerror());
<br class="fancyvrb"><a id="x36-194136r22"></a>22  <br class="fancyvrb"><a id="x36-194138r23"></a>23      rc = func(data);
<br class="fancyvrb"><a id="x36-194140r24"></a>24      check(rc == <span id="textcolor4599">0</span>, <span class="colorbox" id="colorbox4600"><span id="textcolor4601">"</span></span><span class="colorbox" id="colorbox4602"><span id="textcolor4603">Function %s return %d for data: %s</span></span><span class="colorbox" id="colorbox4604"><span id="textcolor4605">"</span></span>, func_to_run, rc, data);
<br class="fancyvrb"><a id="x36-194142r25"></a>25  <br class="fancyvrb"><a id="x36-194144r26"></a>26      rc = dlclose(lib);<br class="fancyvrb"><a id="x36-194146r27"></a>27      check(rc == <span id="textcolor4606">0</span>, <span class="colorbox" id="colorbox4607"><span id="textcolor4608">"</span></span><span class="colorbox" id="colorbox4609"><span id="textcolor4610">Failed to close %s</span></span><span class="colorbox" id="colorbox4611"><span id="textcolor4612">"</span></span>, lib_file);
<br class="fancyvrb"><a id="x36-194148r28"></a>28  <br class="fancyvrb"><a id="x36-194150r29"></a>29      <span id="textcolor4613">return</span> <span id="textcolor4614">0</span>;<br class="fancyvrb"><a id="x36-194152r30"></a>30  <br class="fancyvrb"><a id="x36-194154r31"></a>31  <span id="textcolor4615">error:</span><br class="fancyvrb"><a id="x36-194156r32"></a>32      <span id="textcolor4616">return</span> <span id="textcolor4617">1</span>;<br class="fancyvrb"><a id="x36-194158r33"></a>33  }</div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><!--l. 153--><p class="indent">    I’ll now break this down so you can see what’s going on in this small bit of
useful code:
     </p><dl class="description"><dt class="description">
ex29.c:5 </dt><dd class="description">I’ll  use  this  function  pointer  definition  later  to  call  functions  in  the
     library.  This  is  nothing  new,  but  make  sure  you  understand  what  it’s
     doing.
     </dd><dt class="description">
ex29.c:17 </dt><dd class="description">After the usual setup for a small program, I use the dlopen function
     to load up the library indicated by lib_file. This function returns a
     handle that we use later and works a lot like opening a file.
     </dd><dt class="description">
ex29.c:18 </dt><dd class="description">If there’s an error, I do the usual check and exit, but notice at then
     end that I’m using dlerror to find out what the library related error
     was.
     </dd><dt class="description">
ex29.c:20 </dt><dd class="description">I use dlsym to get a function out of the lib by it’s string name in
     func_to_run. This is the powerful part, since I’m dynamically getting
     a pointer to a function based on a string I got from the command line
     argv.
     </dd><dt class="description">
ex29.c:23 </dt><dd class="description">I then call the func function that was returned, and check its return
     value.
     </dd><dt class="description">
ex29.c:26 </dt><dd class="description">Finally, I close the library up just like I would a file. Usually you keep
     these open the whole time the program is running, so closing at the end
     isn’t as useful, but I’m demonstrating it here.</dd></dl><h3 class="sectionHead"><span class="titlemark">30.1    </span> <a id="x36-19500030.1"></a>What You Should See</h3>
                                                                  

                                                                  
<!--l. 179--><p class="noindent">Now that you know what this file does, here’s a shell session of me building the
libex29.so, ex29 and then working with it. Follow along so you learn how these
things are built manually.
                                                                  

                                                                  
<!--l. 183--></p><p class="indent">    <a id="x36-195001r84"></a></p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
 <div class="caption"><span class="id">Source 84: </span><span class="content">                                                                                     Building And Using
libex29.so</span></div><!--tex4ht:label?: x36-195001r84 -->
<div class="fancyvrb" id="fancyvrb51"><a id="x36-195003r1"></a>1  <span id="textcolor4618">#</span> compile the lib file and make the .so<br class="fancyvrb"><a id="x36-195005r2"></a>2  <span id="textcolor4619">$</span> cc -c libex29.c -o libex29.o
<br class="fancyvrb"><a id="x36-195007r3"></a>3  <span id="textcolor4620">$</span> cc -shared -o libex29.so libex29.o<br class="fancyvrb"><a id="x36-195009r4"></a>4  <br class="fancyvrb"><a id="x36-195011r5"></a>5  <span id="textcolor4621">#</span> make the loader program
<br class="fancyvrb"><a id="x36-195013r6"></a>6  <span id="textcolor4622">$</span> cc -Wall -g -DNDEBUG -ldl ex29.c -o ex29<br class="fancyvrb"><a id="x36-195015r7"></a>7  <br class="fancyvrb"><a id="x36-195017r8"></a>8  <span id="textcolor4623">#</span> try it out with some things that work
<br class="fancyvrb"><a id="x36-195019r9"></a>9  <span id="textcolor4624">$</span> ex29 ./libex29.so print_a_message <span class="colorbox" id="colorbox4625"><span id="textcolor4626">"hello there"</span></span><br class="fancyvrb"><a id="x36-195021r10"></a>10  <span id="textcolor4627">-bash: ex29: command not found</span>
<br class="fancyvrb"><a id="x36-195023r11"></a>11  <span id="textcolor4628">$</span> ./ex29 ./libex29.so print_a_message <span class="colorbox" id="colorbox4629"><span id="textcolor4630">"hello there"</span></span>
<br class="fancyvrb"><a id="x36-195025r12"></a>12  <span id="textcolor4631">A STRING: hello there</span><br class="fancyvrb"><a id="x36-195027r13"></a>13  <span id="textcolor4632">$</span> ./ex29 ./libex29.so uppercase <span class="colorbox" id="colorbox4633"><span id="textcolor4634">"hello there"</span></span>
<br class="fancyvrb"><a id="x36-195029r14"></a>14  <span id="textcolor4635">HELLO THERE</span><br class="fancyvrb"><a id="x36-195031r15"></a>15  <span id="textcolor4636">$</span> ./ex29 ./libex29.so lowercase <span class="colorbox" id="colorbox4637"><span id="textcolor4638">"HELLO tHeRe"</span></span>
<br class="fancyvrb"><a id="x36-195033r16"></a>16  <span id="textcolor4639">hello there</span><br class="fancyvrb"><a id="x36-195035r17"></a>17  <span id="textcolor4640">$</span> ./ex29 ./libex29.so fail_on_purpose <span class="colorbox" id="colorbox4641"><span id="textcolor4642">"i fail"</span></span>
<br class="fancyvrb"><a id="x36-195037r18"></a>18  <span id="textcolor4643">[ERROR] (ex29.c:23: errno: None) Function fail_on_purpose return 1 for data: i fail</span>
<br class="fancyvrb"><a id="x36-195039r19"></a>19  <br class="fancyvrb"><a id="x36-195041r20"></a>20  <span id="textcolor4644">#</span> try to give it bad args<br class="fancyvrb"><a id="x36-195043r21"></a>21  <span id="textcolor4645">$</span> ./ex29 ./libex29.so fail_on_purpose
<br class="fancyvrb"><a id="x36-195045r22"></a>22  <span id="textcolor4646">[ERROR] (ex29.c:11: errno: None) USAGE: ex29 libex29.so function data</span><br class="fancyvrb"><a id="x36-195047r23"></a>23  
<br class="fancyvrb"><a id="x36-195049r24"></a>24  <span id="textcolor4647">#</span> try calling a <span id="textcolor4648">function </span>that is not there<br class="fancyvrb"><a id="x36-195051r25"></a>25  <span id="textcolor4649">$</span> ./ex29 ./libex29.so adfasfasdf asdfadff
<br class="fancyvrb"><a id="x36-195053r26"></a>26  <span id="textcolor4650">[ERROR] (ex29.c:20: errno: None) Did not find adfasfasdf </span>
<br class="fancyvrb"><a id="x36-195055r27"></a>27  <span id="textcolor4651">  function in the library libex29.so: dlsym(0x1076009b0, adfasfasdf): symbol not found</span>
<br class="fancyvrb"><a id="x36-195057r28"></a>28  <br class="fancyvrb"><a id="x36-195059r29"></a>29  <span id="textcolor4652">#</span> try loading a .so that is not there<br class="fancyvrb"><a id="x36-195061r30"></a>30  <span id="textcolor4653">$</span> ./ex29 ./libex.so adfasfasdf asdfadfas
<br class="fancyvrb"><a id="x36-195063r31"></a>31  <span id="textcolor4654">[ERROR] (ex29.c:17: errno: No such file or directory) Failed to open</span>
<br class="fancyvrb"><a id="x36-195065r32"></a>32  <span id="textcolor4655">    the library libex.so: dlopen(libex.so, 2): image not found</span><br class="fancyvrb"><a id="x36-195067r33"></a>33  <span id="textcolor4656">$</span></div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><!--l. 222--><p class="indent">    One thing that you may run into is that every OS, every version of every OS,
and every compiler on every version of every OS, seems to want to change the way
you build a shared library every other month that some new programmer thinks it’s
wrong. If the line I use to make the libex29.so file is wrong, then let me know and
I’ll add some comments for other platforms.
    </p><h3 class="sectionHead"><span class="titlemark">30.2    </span> <a id="x36-19600030.2"></a>How To Break It</h3>
<!--l. 230--><p class="noindent">Open libex29.so and edit it with an editor that can handle binary files. Change a
couple bytes, then close it. Try to see if you can get the dlopen function to load it
even though you’ve corrupted it.
<!--l. 235--></p><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">30.3    </span> <a id="x36-19700030.3"></a>Extra Credit</h3>
<!--l. 237--><p class="noindent">
     </p><ol class="enumerate1"><li class="enumerate" id="x36-197002x1">Were  you  paying  attention  to  the  bad  code  I  have  in  the  libex29.c
     functions? See how, even though I use a for-loop they still check for <span class="obeylines-h"><span class="verb">’\0’</span></span>
     endings? Fix this so the functions always take a length for the string to
     work with inside the function.
     </li>
     <li class="enumerate" id="x36-197004x2">Take the c-skeleton skeleton, and create a new project for this exercise.
     Put the libex29.c file in the src/ directory. Change the Makefile so
     that it builds this as build/libex29.so.
     </li>
     <li class="enumerate" id="x36-197006x3">Take the ex29.c file and put it in tests/ex29_tests.c so that it runs
     as a unit test. Make this all work, which means you have to change it so
                                                                  

                                                                  
     that it loads the build/libex29.so file and runs tests similar to what
     I did manually above.
     </li>
     <li class="enumerate" id="x36-197008x4">Read  the  man dlopen documentation  and  read  about  all  the  related
     functions. Try some of the other options to dlopen beside RTLD_NOW.</li></ol><!--l. 1--><div class="crosslinks"><p class="noindent">[<a href="learn-c-the-hard-waych31.html">next</a>] [<a href="learn-c-the-hard-waych29.html">prev</a>] [<a href="learn-c-the-hard-waych29.html#taillearn-c-the-hard-waych29.html">prev-tail</a>] [<a href="learn-c-the-hard-waych30.html">front</a>] [<a href="learn-c-the-hard-waypa2.html#learn-c-the-hard-waych30.html">up</a>] </p></div>
<!--l. 1--><p class="indent">    <a id="taillearn-c-the-hard-waych30.html"></a>   
</p></body></html>