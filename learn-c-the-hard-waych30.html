<html><head><title>习题27: 创造性与防御性编程</title><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="generator"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="originator"></meta><!-- index=1,2,next,fn-in,charset=utf-8,NoFonts,html --><meta content="learn-c-the-hard-way.tex" name="src"></meta><meta content="2012-04-01 17:12:00" name="date"></meta><link href="learn-c-the-hard-way.css" rel="stylesheet" type="text/css"></link></head><body>
    <!--l. 1--><div class="crosslinks"><p class="noindent">[<a href="learn-c-the-hard-waych31.html">next</a>] [<a href="learn-c-the-hard-waypa2.html">prev</a>] [<a href="learn-c-the-hard-waypa2.html#taillearn-c-the-hard-waypa2.html">prev-tail</a>] [<a href="#taillearn-c-the-hard-waych30.html">tail</a>] [<a href="learn-c-the-hard-waypa2.html#learn-c-the-hard-waych30.html">up</a>] </p></div>
    <h2 class="chapterHead"><span class="titlemark">Chapter 30</span><br><a id="x36-17300030"></a>习题27: 创造性与防御性编程</h2>
<!--l. 3--><p class="noindent">You have now learned most of the basics of C programming and are ready to start
becoming a serious programmer. This is where you go from beginner to expert, both
with C and hopefully with core computer science concepts. I will be teaching you
a few of the core data structures and algorithms that every programmer
                                                                  

                                                                  
should know, and then a few very interesting ones I’ve used in real software
for years. 你已经学习了大部分 C 语言编程的基础知识，已经可以开始做一个真正的程序员了。这正是你从入门到专家的起点，依靠 C 还有计算机科学的核心概念。我会传教你一些每个程序员都应该知道的关键的数据结构和算法，然后就是一些我在这些年实际软件编程中觉得有意思的东西。
<!--l. 11--></p><p class="indent">    Before I can do that I have to teach you some basic skills and ideas that will help
you make better software. Exercises 27 through 31 will teach you advanced concepts
and feature more talking than code, but after those you’ll apply what you learn to
making a core library of useful data structures. 在开始之前，我不得不先教一些基础的技巧和思想，可以帮助你更好的编程。习题 27 到 32 会通过较多的文字稍少的代码来教你一些高级的概念和特性，但在这之后，你应该用你所学去做一个有用的数据结构的核心库。
<!--l. 18--></p><p class="indent">    The first step in getting better at writing C code (and really any language) is to
learn a new mindset called ”defensive programming”. Defensive programming
assumes that you are going to make many mistakes and then attempts to prevent
them at every possible step. In this exercise I’m going to teach you how to think
about programming defensively. 要写出更好的 C 代码（任何语言），第一步就是要学习一种叫做“防御性编程”的思维模式。防御性编程是设想你会出很多错误而且你应该在任何可能的步骤中尝试阻止错误发生。在本次习题中，我将教给你如何去思考防御性的编程。
    </p><h3 class="sectionHead"><span class="titlemark">30.1    </span> <a id="x36-17400030.1"></a>The Creative Programmer Mindset</h3>
<!--l. 28--><p class="noindent">It’s not possible to tell you how to be creative in a short exercise like this, but I will
tell you that creativity involves taking risks and being open minded. Fear will
quickly kill creativity, so the mindset I adopt, and many programmers adopt on,
accident is designed to make me unafraid of taking chances and looking like an
idiot: 在这样一个简短的练习中不可能叫你富有创造性，
<!--l. 35--></p><p class="indent">
     </p><ol class="enumerate1"><li class="enumerate" id="x36-174002x1">我一个错误也不会有。
                                                                  

                                                                  
     </li>
     <li class="enumerate" id="x36-174004x2">无所谓大家怎么在想。
     </li>
     <li class="enumerate" id="x36-174006x3">所有我脑海中的点子都是伟大的。</li></ol><!--l. 41--><p class="indent">    I only adopt this mindset temporarily, and even have little tricks to turn it on. By
doing this I can come up with ideas, find creative solutions, open my thoughts to
odd connections, and just generally invent weirdness without fear. In this mindset I
will typically write a horrible first version of something just to get the idea
out.
<!--l. 47--></p><p class="indent">    However, when I’ve finished my creative prototype I will throw it out and get
serious about making it solid. Where other people make a mistake is carrying
the creative mindset into their implementation phase. This then leads to
a very different destructive mindset that is the dark side of the creative
mindset:
<!--l. 53--></p><p class="indent">
     </p><ol class="enumerate1"><li class="enumerate" id="x36-174008x1">写出完美的软件是有可能的。
     </li>
     <li class="enumerate" id="x36-174010x2">My brain tells me the truth, and it can’t find any errors, therefore I have
     written perfect software.
     </li>
     <li class="enumerate" id="x36-174012x3">My code is who I am and people who criticize its perfection are criticizing
     me.</li></ol><!--l. 59--><p class="indent">    These are lies. You will frequently run into programmers who feel intense pride
about what they’ve created, which is natural, but this pride gets in the way of their
ability to objectively improve their craft. Because of pride and attachment to what
they’ve written, they can continue to believe that what they write is perfect. As long
as they ignore other people’s criticism of their code they can protect their fragile ego
and never improve.
<!--l. 66--></p><p class="indent">    The trick to being creative and making solid software is to also be able to adopt a
defensive programming mindset.
                                                                  

                                                                  
<!--l. 70--></p><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">30.2    </span> <a id="x36-17500030.2"></a>The Defensive Programmer Mindset</h3>
<!--l. 72--><p class="noindent">After you have a working creative prototype and you’re feeling good about the idea,
it’s time to switch to being a defensive programmer. The defensive programmer
basically hates your code and believes these things:
<!--l. 76--></p><p class="indent">
     </p><ol class="enumerate1"><li class="enumerate" id="x36-175002x1">Software has errors.
     </li>
     <li class="enumerate" id="x36-175004x2">You are not your software, yet you are are responsible for the errors.
     </li>
     <li class="enumerate" id="x36-175006x3">You can never remove the errors, only reduce their probability.</li></ol><!--l. 82--><p class="indent">    This mindset lets you be honest about your work and critically analyze it for
improvements. Notice that it doesn’t say you are full of errors? It says your code is
full of errors. This is a significant thing to understand because it gives you the power
of objectivity for the next implementation.
<!--l. 88--></p><p class="indent">    Just like the creative mindset, the defensive programming mindset has a dark
side as well. The defensive programmer is a paranoid who is afraid of everything,
and this fear prevents them from possibly being wrong or making mistakes. That’s
great when you are trying to be ruthlessly consistent and correct, but it is murder on
creative energy and concentration.
<!--l. 96--></p><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">30.3    </span> <a id="x36-17600030.3"></a>The Eight Defensive Programmer Strategies</h3>
<!--l. 98--><p class="noindent">Once you’ve adopted this mindset, you can then rewrite your prototype and
                                                                  

                                                                  
follow a set of eight strategies I use to make my code as solid as I can. While I
work on the ”real” version I ruthlessly follow these strategies and try to
remove as many errors as I can, thinking like someone who wants to break the
software.
     </p><dl class="description"><dt class="description">
Never Trust Input </dt><dd class="description">Never trust the data you are given and always validate it.
     </dd><dt class="description">
Prevent Errors </dt><dd class="description">If an error is possible, no matter how probable, try to prevent
     it.
     </dd><dt class="description">
Fail Early And Openly </dt><dd class="description">Fail early, cleanly, and openly, stating what happened,
     where and how to fix it.
     </dd><dt class="description">
Document Assumptions </dt><dd class="description">Clearly  state  the  pre-conditions,  post-conditions,
     and invariants.
     </dd><dt class="description">
Prevention Over Documentation </dt><dd class="description">Do not do with documentation, that which
     can be done with code or avoided completely.
     </dd><dt class="description">
Automate Everything </dt><dd class="description">Automate everything, especially testing.
     </dd><dt class="description">
Simplify And Clarify </dt><dd class="description">Always simplify the code to the smallest, cleanest form
     that works without sacrificing safety.
     </dd><dt class="description">
Question Authority </dt><dd class="description">Do not blindly follow or reject rules.</dd></dl><!--l. 115--><p class="indent">    These aren’t the only ones, but they’re the core things I feel programmers have
to focus on when trying to make good solid code. Notice that I don’t really say
exactly how to do these. I’ll go into each of these in more detail, and some of the
exercises actually cover them extensively.
                                                                  

                                                                  
<!--l. 121--></p><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">30.4    </span> <a id="x36-17700030.4"></a>Applying The Eight Strategies</h3>
<!--l. 123--><p class="noindent">I’ll now go through each of the eight strategies and give some basic advice and
examples on how to use them in real code. This will help you understand these
better since they may be vague or misinterpreted.
<!--l. 127--></p><p class="noindent">
    </p><h4 class="subsectionHead"><span class="titlemark">30.4.1    </span> <a id="x36-17800030.4.1"></a>Never Trust Input</h4>
<!--l. 129--><p class="noindent">Explain untrusted inputs. Use a few examples from the real world, maybe the recent
Rails and Github attack. Show a simple C examples using C strings taken from a
socket.
<!--l. 132--></p><p class="noindent">
    </p><h4 class="subsectionHead"><span class="titlemark">30.4.2    </span> <a id="x36-17900030.4.2"></a>Prevent Errors</h4>
<!--l. 134--><p class="noindent">Discuss the difference between a possible error and a probable error, then how
humans are very bad at determining probability, therefore you should try to block all
the possible errors you can.
<!--l. 138--></p><p class="noindent">
    </p><h4 class="subsectionHead"><span class="titlemark">30.4.3    </span> <a id="x36-18000030.4.3"></a>Fail Early And Openly</h4>
<!--l. 140--><p class="noindent">Show how my awesome macros help you do this and discuss good error messages.
Make sure they understand that you should try to explain how to maybe fix it, or
                                                                  

                                                                  
report the defect.
<!--l. 143--></p><p class="noindent">
    </p><h4 class="subsectionHead"><span class="titlemark">30.4.4    </span> <a id="x36-18100030.4.4"></a>Document Assumptions</h4>
<!--l. 145--><p class="noindent">Explain design by contract and how you can use it to create pre-conditions,
post-conditions, and invariants. Show a simple example of this with a function that
has it all.
<!--l. 148--></p><p class="noindent">
    </p><h4 class="subsectionHead"><span class="titlemark">30.4.5    </span> <a id="x36-18200030.4.5"></a>Prevention Over Documentation</h4>
<!--l. 150--><p class="noindent">Talk about how programmers think that a documented flaw means there is no flaw
and that they should just remove the flaw.
<!--l. 153--></p><p class="noindent">
    </p><h4 class="subsectionHead"><span class="titlemark">30.4.6    </span> <a id="x36-18300030.4.6"></a>Automate Everything</h4>
<!--l. 155--><p class="noindent">Discuss the advantages of automated testing and how I’ll teach that in a later
exercise.
<!--l. 157--></p><p class="noindent">
    </p><h4 class="subsectionHead"><span class="titlemark">30.4.7    </span> <a id="x36-18400030.4.7"></a>Simplify And Clarify</h4>
<!--l. 159--><p class="noindent">Talk about how simpler code wins over more complex code because it reduces the
probability of an error by reducing the number of branches and couplings in the
code.
                                                                  

                                                                  
<!--l. 162--></p><p class="noindent">
    </p><h4 class="subsectionHead"><span class="titlemark">30.4.8    </span> <a id="x36-18500030.4.8"></a>Question Authority</h4>
<!--l. 164--><p class="noindent">The final strategy is the most important because it breaks you out of the defensive
programming mindset and lets you transition into the creative mindset. Defensive
programming is authoritarian and it can be cruel. The job of this mindset is to
make you follow rules because without them you’ll miss something or get
distracted.
<!--l. 170--></p><p class="indent">    This authoritarian attitude has the disadvantage of disabling independent
creative thought. Rules are necessary for getting things done, but being a slave to
them will kill your creativity.
<!--l. 174--></p><p class="indent">    This final strategy means you should question the rules you follow
periodically and assume that they could be wrong, just like the software
you are reviewing. What I will typically do is, after a session of defensive
programming, I’ll go take a non-programming break and let the rules go. Then I’ll
be ready to do some creative work or do more defensive coding if need
to.
<!--l. 180--></p><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">30.5    </span> <a id="x36-18600030.5"></a>Order Is Not Important</h3>
<!--l. 182--><p class="noindent">The final thing I’ll say on this philosophy is that I’m not telling you to do this in a
strict oder of ”CREATE! DEFEND! CREATE! DEFEND!” At first you may
want to do that, but I will actually do either in varying amounts depend on
what I want to do, and I may even meld them together with no defined
boundary.
<!--l. 187--></p><p class="indent">    I also don’t think one mindset is better than another, or that there are
strict separation between them. You need both creativity and strictness to do
programming well, so work on both if you want to improve.
                                                                  

                                                                  
<!--l. 192--></p><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">30.6    </span> <a id="x36-18700030.6"></a>Extra Credit</h3>
<!--l. 194--><p class="noindent">
     </p><ol class="enumerate1"><li class="enumerate" id="x36-187002x1">The code in the book up to this point (and for the rest of it) potentially
     violates these rules. Go back through and apply what you’ve learned to
     one exercise to see if you can improve it or find bugs.
     </li>
     <li class="enumerate" id="x36-187004x2">Find  an  open  source  project  and  give  some  of  the  files  a  similar  code
     review. Submit a patch that fixes a bug if you find it.</li></ol><!--l. 1--><div class="crosslinks"><p class="noindent">[<a href="learn-c-the-hard-waych31.html">next</a>] [<a href="learn-c-the-hard-waypa2.html">prev</a>] [<a href="learn-c-the-hard-waypa2.html#taillearn-c-the-hard-waypa2.html">prev-tail</a>] [<a href="learn-c-the-hard-waych30.html">front</a>] [<a href="learn-c-the-hard-waypa2.html#learn-c-the-hard-waych30.html">up</a>] </p></div>
<!--l. 1--><p class="indent">    <a id="taillearn-c-the-hard-waych30.html"></a>   
</p></body></html>