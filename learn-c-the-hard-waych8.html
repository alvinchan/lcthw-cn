<html><head><title>习题7: 再讲点变量，加上点算术</title><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="generator"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="originator"></meta><!-- index=1,2,next,fn-in,charset=utf-8,NoFonts,html --><meta content="learn-c-the-hard-way.tex" name="src"></meta><meta content="2012-04-11 10:56:00" name="date"></meta><link href="learn-c-the-hard-way.css" rel="stylesheet" type="text/css"></link></head><body>
    <!--l. 1--><div class="crosslinks"><p class="noindent">[<a>prev</a>] [<a href="#taillearn-c-the-hard-way">prev-tail</a>] [<a href="#tail">tail</a>] [<a href="# ">up</a>] </p></div>
    <h2 class="chapterHead"><span class="titlemark">Chapter 8</span><br><a id="x13-420008"></a>习题7: 再讲点变量，加上点算术</h2>
<!--l. 3--><p class="noindent">让我们通过声明更多的变量类型来熟悉变量的用法，这些类型包括 int(整数型)、
float(单精度浮点型)、char(字符型)、以及 double(双精度浮点型)。我们会在稍后的各种数学表达式中用到它们，同时你还会学到 C 语言的基础数学。
                                                                  

                                                                  
<!--l. 5--></p><p class="indent">    </p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
<a id="x13-42001r23"></a>
<div class="caption"><span class="id">Source 23: </span><span class="content">                                                                                                              ex7.c</span></div><!--tex4ht:label?: x13-42001r23 -->
<div class="fancyvrb" id="fancyvrb7"><a id="x13-42003r1"></a>1  <span id="textcolor178">#</span><span id="textcolor179">include <stdio.h></stdio.h></span><br class="fancyvrb"><a id="x13-42005r2"></a>2  <br class="fancyvrb"><a id="x13-42007r3"></a>3  <span id="textcolor180">int</span> <span id="textcolor181">main</span>(<span id="textcolor182">int</span> argc, <span id="textcolor183">char</span> ⋆argv[])
<br class="fancyvrb"><a id="x13-42009r4"></a>4  {<br class="fancyvrb"><a id="x13-42011r5"></a>5      <span id="textcolor184">int</span> bugs = <span id="textcolor185">100</span>;<br class="fancyvrb"><a id="x13-42013r6"></a>6      <span id="textcolor186">double</span> bug_rate = <span id="textcolor187">1.2</span>;<br class="fancyvrb"><a id="x13-42015r7"></a>7  
<br class="fancyvrb"><a id="x13-42017r8"></a>8      printf(<span class="colorbox" id="colorbox188"><span id="textcolor189">"</span></span><span class="colorbox" id="colorbox190"><span id="textcolor191">You have %d bugs at the imaginary rate of %f.</span></span><span class="colorbox" id="colorbox192"><span id="textcolor193">\n</span></span><span class="colorbox" id="colorbox194"><span id="textcolor195">"</span></span>,
<br class="fancyvrb"><a id="x13-42019r9"></a>9              bugs, bug_rate);<br class="fancyvrb"><a id="x13-42021r10"></a>10  <br class="fancyvrb"><a id="x13-42023r11"></a>11      <span id="textcolor196">long</span> universe_of_defects = <span id="textcolor197">1L</span> ⋆ <span id="textcolor198">1024L</span> ⋆ <span id="textcolor199">1024L</span> ⋆ <span id="textcolor200">1024L</span>;
<br class="fancyvrb"><a id="x13-42025r12"></a>12      printf(<span class="colorbox" id="colorbox201"><span id="textcolor202">"</span></span><span class="colorbox" id="colorbox203"><span id="textcolor204">The entire universe has %ld bugs.</span></span><span class="colorbox" id="colorbox205"><span id="textcolor206">\n</span></span><span class="colorbox" id="colorbox207"><span id="textcolor208">"</span></span>,
<br class="fancyvrb"><a id="x13-42027r13"></a>13              universe_of_defects);<br class="fancyvrb"><a id="x13-42029r14"></a>14  <br class="fancyvrb"><a id="x13-42031r15"></a>15      <span id="textcolor209">double</span> expected_bugs = bugs ⋆ bug_rate;
<br class="fancyvrb"><a id="x13-42033r16"></a>16      printf(<span class="colorbox" id="colorbox210"><span id="textcolor211">"</span></span><span class="colorbox" id="colorbox212"><span id="textcolor213">You are expected to have %f bugs.</span></span><span class="colorbox" id="colorbox214"><span id="textcolor215">\n</span></span><span class="colorbox" id="colorbox216"><span id="textcolor217">"</span></span>,<br class="fancyvrb"><a id="x13-42035r17"></a>17              expected_bugs);
<br class="fancyvrb"><a id="x13-42037r18"></a>18  <br class="fancyvrb"><a id="x13-42039r19"></a>19      <span id="textcolor218">double</span> part_of_universe = expected_bugs / universe_of_defects;
<br class="fancyvrb"><a id="x13-42041r20"></a>20      printf(<span class="colorbox" id="colorbox219"><span id="textcolor220">"</span></span><span class="colorbox" id="colorbox221"><span id="textcolor222">That is only a %e portion of the universe.</span></span><span class="colorbox" id="colorbox223"><span id="textcolor224">\n</span></span><span class="colorbox" id="colorbox225"><span id="textcolor226">"</span></span>,<br class="fancyvrb"><a id="x13-42043r21"></a>21              part_of_universe);
<br class="fancyvrb"><a id="x13-42045r22"></a>22  <br class="fancyvrb"><a id="x13-42047r23"></a>23      <span id="textcolor227">// this makes no sense, just a demo of something weird</span>
<br class="fancyvrb"><a id="x13-42049r24"></a>24      <span id="textcolor228">char</span> nul_byte = <span class="colorbox" id="colorbox229"><span id="textcolor230">’\0’</span></span>;<br class="fancyvrb"><a id="x13-42051r25"></a>25      <span id="textcolor231">int</span> care_percentage = bugs ⋆ nul_byte;
<br class="fancyvrb"><a id="x13-42053r26"></a>26      printf(<span class="colorbox" id="colorbox232"><span id="textcolor233">"</span></span><span class="colorbox" id="colorbox234"><span id="textcolor235">Which means you should care %d%%.</span></span><span class="colorbox" id="colorbox236"><span id="textcolor237">\n</span></span><span class="colorbox" id="colorbox238"><span id="textcolor239">"</span></span>,
<br class="fancyvrb"><a id="x13-42055r27"></a>27              care_percentage);<br class="fancyvrb"><a id="x13-42057r28"></a>28  <br class="fancyvrb"><a id="x13-42059r29"></a>29      <span id="textcolor240">return</span> <span id="textcolor241">0</span>;<br class="fancyvrb"><a id="x13-42061r30"></a>30  }</div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><!--l. 41--><p class="indent">    以下就是这段毫无意义的代码所做的事情：
     </p><dl class="description"><dt class="description">
ex7.c:1-4 </dt><dd class="description">常见的 C 程序开头。
     </dd><dt class="description">
ex7.c:5-6 </dt><dd class="description">为一些虚假的 bug 数据声明一个 int 和一个 double 类型的变量。
     </dd><dt class="description">
ex7.c:8-9 </dt><dd class="description">没什么新的知识点，就是把这俩变量打印出来。
     </dd><dt class="description">
ex7.c:11 </dt><dd class="description">用一种新的变量类型 long 声明一个大数字。
     </dd><dt class="description">
ex7.c:12-13 </dt><dd class="description">使用 <span class="obeylines-h"><span class="verb">%ld</span></span> 输出那个数， <span class="obeylines-h"><span class="verb">%ld</span></span> 是在 <span class="obeylines-h"><span class="verb">%d</span></span> 前加了个修饰符。增加的字母
    “l”的意思是”按长整型（long decimal）打印出这个数”。
     </dd><dt class="description">
ex7.c:15-17 </dt><dd class="description">更多的数学计算和打印输出而已。
     </dd><dt class="description">
ex7.c:19-21 </dt><dd class="description">打造出一个变量，用来描述你的 bug 和宇宙中 bug 总数的比值，当然这个计算结果是完全不准确的。我们可以用修饰符 <span class="obeylines-h"><span class="verb">%e</span></span> 用科学计数法输出结果.
     </dd><dt class="description">
ex7.c:24 </dt><dd class="description">用 <span class="obeylines-h"><span class="verb">’\0’</span></span>这样的特殊语法创建一个字符变量，这样就建立了一个“空字节(nul byte)”字符. 它其实就是数字 0。
     </dd><dt class="description">
ex7.c:25 </dt><dd class="description">用这个字符乘以 bugs 变量，你期待的问题就有了 0 这个结果。这里向你演示了一个丑陋的代码技巧，有时你会在一些地方看到这种用法。
     </dd><dt class="description">
ex7.c:26-27 </dt><dd class="description">输出那个结果, 注意到我使用 <span class="obeylines-h"><span class="verb">%%</span></span> (两个百分号)，这样我就可以打印出’%’ 这个百分号字符来。
     </dd><dt class="description">
ex7.c:28-30 </dt><dd class="description">main 函数的结尾。</dd></dl><!--l. 57--><p class="indent">    这些代码只是一个练习，用来为你演示算术的原理。在代码的结尾处你也看见了只有 C 中有，而别的语言中没有的东西。对于 C 语言来说，
字符只是整数而已。其实它是一种非常小的整数，仅此而已。这就意味着你可以用它们做数学运算，很多软件就是这么做的，不管目的是好是坏。
<!--l. 59--></p><p class="indent">    最后的这点内容是让你初窥 C 语言是直接访问机器的过程。我们会在后面的联系中进一步探索这个课题。
    </p><h3 class="sectionHead"><span class="titlemark">8.1    </span> <a id="x13-430008.1"></a>你应该看到的结果</h3>
<!--l. 63--><p class="noindent">和平常一样，这些是你应该在输出中看到的结果：
                                                                  

                                                                  
<!--l. 65--></p><p class="indent">    </p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
<a id="x13-43001r24"></a>
<div class="caption"><span class="id">Source 24: </span><span class="content">                                                                                                            ex7 输出</span></div><!--tex4ht:label?: x13-43001r24 -->
<!--l. 66-->
<div class="lstlisting" id="listing-18"><span class="label"><a id="x13-43002r1"></a>1</span>$ make ex7 <br><span class="label"><a id="x13-43003r2"></a>2</span>cc -Wall -g    ex7.c   -o ex7 <br><span class="label"><a id="x13-43004r3"></a>3</span>$ ./ex7 <br><span class="label"><a id="x13-43005r4"></a>4</span>You have 100 bugs at the imaginary rate of 1.200000. <br><span class="label"><a id="x13-43006r5"></a>5</span>The entire universe has 1073741824 bugs. <br><span class="label"><a id="x13-43007r6"></a>6</span>You are expected to have 120.000000 bugs. <br><span class="label"><a id="x13-43008r7"></a>7</span>That is only a 1.117587e-07 portion of the universe. <br><span class="label"><a id="x13-43009r8"></a>8</span>Which means you should care 0%. <br><span class="label"><a id="x13-43010r9"></a>9</span>$
</div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><h3 class="sectionHead"><span class="titlemark">8.2    </span> <a id="x13-440008.2"></a>让程序出错</h3>
<!--l. 83--><p class="noindent">同样的，试着往 printf 中传递错的参数来让程序出错。对比使用修饰符 <span class="obeylines-h"><span class="verb">%s</span></span> 和 <span class="obeylines-h"><span class="verb">%c</span></span> 输出 nul_byte 有什么不同结果。当你让程序出错后，在 Valgrind 运行你的程序，看看它对你的破坏行为如何报错。
<!--l. 85--></p><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">8.3    </span> <a id="x13-450008.3"></a>加分习题</h3>
<!--l. 87--><p class="noindent">
     </p><ol class="enumerate1"><li class="enumerate" id="x13-45002x1">给 universe_of_defects 赋不同大小的值直到从编译器获得警告信息。
     </li>
     <li class="enumerate" id="x13-45004x2">这些庞大数字实际上打印出的是什么？
     </li>
     <li class="enumerate" id="x13-45006x3">把 long 换成 unsigned long，试着找到比刚才那个数更大的值。
     </li>
     <li class="enumerate" id="x13-45008x4">上网查查 unsigned 的功能是什么。
     </li>
     <li class="enumerate" id="x13-45010x5">在下一个练习之前，试着向自己解释为什么 char 可以和 int 相乘.</li></ol><!--l. 1--><div class="crosslinks"><p class="noindent">[<a>prev</a>] [<a href="#taillearn-c-the-hard-way">prev-tail</a>] [<a>front</a>] [<a href="# ">up</a>] </p></div>
<!--l. 1--><p class="indent">    <a id="tail"></a>   
</p></body></html>