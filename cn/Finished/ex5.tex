\chapter{Exercise 5: C 程序的结构}

你现在已经知道了怎么使用 \ident{printf} ，也有了一些可供你支配使用的基本工具，所以我们现在来逐行分析一个简单 C 语言程序的结构。在这个程序里你将会敲一些你还不熟悉的东西，我将会慢慢地拆解他们。在接下来的一些练习中我们将继续与这些概念打交道。

\begin{code}{ex5.c}
<< d['code/ex5.c|pyg|l'] >>
\end{code}

把这些代码敲出来，然后使它运行并且保证\emph{Valgrind没有报错}。你也许没法确保，但是你要养成检查的好习惯。

\section{你应该看到的结果}

这是个很无聊的输出，但是这个练习的关键是分析代码:

\begin{code}{ex5 的输出}
\begin{lstlisting}
<< d['code/ex5.out'] >>
\end{lstlisting}
\end{code}

\section{代码详解}

在敲这些代码的时候，也许你已经察觉到这些代码中包含的 C 语言特征。让我们来快速地逐行解读一下这些代码，然后通过练习来更好地理解每一个部分。

\begin{description}
\item[ex5.c:1] \ident{include} 指令的作用是把被包含的文件内容导出到当前源文件中。C 语言的惯例是使用 \file{.h} 后缀来表示头文件，头文件包含了你在程序中需要用到的函数的列表。
\item[ex5.c:3] 这是一个多行的\ident{注释(comment)}，你可以随意在\verb|/*| 和\verb|*/| 之间包含任意多的字符。
\item[ex5.c:4] 到现在为止你一直在"盲目地"使用一个复杂形式的 \ident{主函数(main function)}。C 程序是怎么运行的呢？首先由操作系统加载你的程序，然后运行一个名为 \ident{main} 的函数。这个函数完全结束的时候，它会返回一个 \ident{整数型} 的返回值，另外，该函数需要两个参数，一个是参数个数，它的类型为 \ident{int}，还有一个参数是数组，它用来保存所有输入的参数，它是一个字符串(\ident{char *})数组。是不是很难理解？别担心，我们很快就会讲到它们。
\item[ex5.c:5] 开始任何一个函数体的时候，你需要使用 \verb|{| 来指出这是一个"块(block)"的开始。在 Python 中你只需要写一个 \verb|:| 并且缩进即可。在其他的一些编程语言中也许你需要用 \ident{begin} 或者 \ident{do} 来表示一个块的开始。
\item[ex5.c:6] 一个变量的声明和赋值可以在同一时间完成。你可以使用 \verb|type name = value;| 这个语法来创建一个变量。
    C语言的表达式(除了逻辑条件)以 \verb|';'|(semicolon) 字符来结尾。
\item[ex5.c:8] 另一种形式的注释，它和 Python 和 Ruby 的注释一样，从 \verb|//| 开始，到一行的结尾结束。
\item[ex5.c:9] 又一次调用你的老朋友，\ident{printf} 函数。像很多其他语言一样，函数调用的语法是 \verb|name(arg1, arg2);| ，也可以没有参数，或者有任意数量的参数。稍后我们会看到， \ident{printf} 函数是一个比较怪异的函数，因为它的参数数量是可变的。
\item[ex5.c:11] 函数的返回语句，它将会给操作系统返回一个程序退出的值，可能你还不熟悉 UNIX 软件怎样使用返回值，同样，我们一会就会看到。
\item[ex5.c:12] 最终，我们用一个右花括号(\verb|}|)结束 main 函数。这也是程序的结尾。
\end{description}

在这段分析里有很多的信息，所以请逐行学习并且确保你至少对接下来要做的事情有一点把握。你可能不会知道所有的东西，但是你可以在继续前进之前大概猜测到。

\section{加分习题}

\begin{enumerate}
\item 针对每一行，写下那些你不理解的符号，看看你是否能猜到他们是什么意思。在纸上画一个表格把你的猜测记下来，等会可以回来检查一下你是否猜对了。
\item 回到之前练习题中的代码并做类似的解析，看看你是否理解了这些代码。写下你自己不知道和不能解释的东西。
\end{enumerate}
