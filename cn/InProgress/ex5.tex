\chapter{Exercise 5: C 程序中的结构体}

你现在已经知道了怎么使用 \ident{printf} ,也有了一些基本的可供你支配使用的工具，所以我们现在来一行一行分析一个简单的 C 语言程序是怎么组成的。在这个程序里你将会敲一些你还不熟悉的东西，我将会慢慢地拆解他们。在接下来的一些练习中我们将与这些概念打交道。

\begin{code}{ex5.c}
<< d['code/ex5.c|pyg|l'] >>
\end{code}

把这些代码敲出来，然后使它运行并且保证\emph{没有Valgrind报的错误(no Valgrind errors)}。你也许不会但是应该有把它们保存好的习惯(checking in)。

\section{你会看到什么}

这是个很无聊的输出，但是这个练习的关键是分析代码:

\begin{code}{ex5 output}
\begin{lstlisting}
<< d['code/ex5.out|dexy'] >>
\end{lstlisting}
\end{code}

\section{拆解代码}

在你敲这些代码的时候也许你已经稍微察觉到了这些代码中包含的一些 C 语言的特征。让我们来快速地一行一行地分解这些代码，然后通过做练习来更好地理解每一个部分。

\begin{描述}
\item[ex5.c:1] 一条 \ident{include} 指令是用来把被包含的文件内容导出到当前源文件。C 语言的惯例是使用 \file{.h} 后缀来表示头文件，头文件包含了你在程序中需要用到的函数的列表。
\item[ex5.c:3] 这是一个多行的\ident{注释(comment)}，你可以在\verb|/*| 和\verb|*/| 之间包含任意多的字符，只要你愿意。
\item[ex5.c:4] 迄今为止你一直"盲目地"在使用一个较复杂形式的 \ident{主函数(main function)}。C 程序是怎么运行的呢？首先由操作系统(operating system)加载你的程序，然后运行一个名为 \ident{main}的函数。这个函数完全结束的时候，它需要返回一个类型为 \ident{int} 的返回值，同时，该函数需要两个参数，一个是参数个数，它的类型为 \ident{int}，还有一个参数是数组，它用来保存所有输入的参数，它是一个字符串(\indet{char *})数组。是不是很难理解？不过不要担心，我们很快就会来讲述它们。
\item[ex5.c:5] 开始任何一个函数体的时候，你需要使用 \verb|{| 来指出这是一个"块(block)"的开始。在 Python 中你只需要写一个 \verb|:| 并且缩进即可。在其他的一些编程语言中也许你需要用 \ident{begin} 或者 \ident{do} 来表示一个块的开始。
\item[ex5.c:6] 一个变量的声明和赋值可以在同一时间完成。你可以使用 \verb|type name = value;| 这个语法来创建一个变量。
    C语言的表达式(除了逻辑条件)以 \verb|';'|(semicolon) 字符来结尾。
\item[ex5.c:8] 另一种形式的注释，它和 Python 和 Ruby 的注释一样，从 \verb|//| 开始，到一行的结尾结束。
\item[ex5.c:9] 又一次调用你的老朋友，\ident{printf} 函数。像很多其他语言一样，函数调用的语法是 \verb|name(arg1, arg2);|，也可以没有参数，或者有任意数量的参数。\ident{printf} 函数是一个比较怪异的函数，因为它的参数数量是可变的。稍后我们就会看到。
\item[ex5.c:11] 函数的返回语句，它将会给操作系统返回一个程序退出的值，可能你还不熟悉 UNIX 软件怎样使用返回值，同样，我们一会就会看到。
\item[ex5.c:12] 最终，我们用一个右花括号(\verb|}|)结束 main 函数。这也是程序的结尾。
\end{描述}

在这段分析里有很多的信息，所以请一行一行地学习并且确保你至少对接下来要做的事情有一点把握。你可能不会知道所有的东西，但是你可以在继续前进之前大概猜测到。

\section{加分习题}

\begin{枚举类型}
\item 对每一行，写出那些你不理解的符号，看看你是否能猜到他们是什么意思。把你的猜测在纸上画一个表格，等会可以回来检查一下你是否猜测正确。
\item 回到之前练习题中的代码，并做类似的分析看看你是否理解。写下你自己不知道和不能解释的东西。
\end{枚举类型}
