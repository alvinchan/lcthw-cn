<html><head><title>习题14: 创建和使用函数</title><meta content="text/html; charset=utf-8" http-equiv="Content-Type"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="generator"></meta><meta content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" name="originator"></meta><!-- index=1,2,next,fn-in,charset=utf-8,NoFonts,html --><meta content="learn-c-the-hard-way.tex" name="src"></meta><meta content="2012-04-01 17:12:00" name="date"></meta><link href="learn-c-the-hard-way.css" rel="stylesheet" type="text/css"></link></head><body>
    <!--l. 1--><div class="crosslinks"><p class="noindent">[<a href="learn-c-the-hard-waych16.html">next</a>] [<a href="learn-c-the-hard-waych14.html">prev</a>] [<a href="learn-c-the-hard-waych14.html#taillearn-c-the-hard-waych14.html">prev-tail</a>] [<a href="#taillearn-c-the-hard-waych15.html">tail</a>] [<a href="learn-c-the-hard-waypa1.html#learn-c-the-hard-waych15.html">up</a>] </p></div>
    <h2 class="chapterHead"><span class="titlemark">Chapter 15</span><br><a id="x20-7100015"></a>习题14: 创建和使用函数</h2>
<!--l. 3--><p class="noindent">目前为止你已经使用了部分由头文件 stdio.h 包含的函数。在这个练习中你将会写一些函数并使用一些别的函数。
                                                                  

                                                                  
<!--l. 5--></p><p class="indent">    <a id="x20-71001r37"></a></p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
<div class="caption"><span class="id">Source 37: </span><span class="content">                                                                                                            ex14.c</span></div><!--tex4ht:label?: x20-71001r37 -->
<div class="fancyvrb" id="fancyvrb17"><a id="x20-71003r1"></a>1  <span id="textcolor843">#</span><span id="textcolor844">include <stdio.h></stdio.h></span><br class="fancyvrb"><a id="x20-71005r2"></a>2  <span id="textcolor845">#</span><span id="textcolor846">include <ctype.h></ctype.h></span><br class="fancyvrb"><a id="x20-71007r3"></a>3  <br class="fancyvrb"><a id="x20-71009r4"></a>4  <span id="textcolor847">// forward declarations</span>
<br class="fancyvrb"><a id="x20-71011r5"></a>5  <span id="textcolor848">int</span> can_print_it(<span id="textcolor849">char</span> ch);<br class="fancyvrb"><a id="x20-71013r6"></a>6  <span id="textcolor850">void</span> print_letters(<span id="textcolor851">char</span> arg[]);<br class="fancyvrb"><a id="x20-71015r7"></a>7  
<br class="fancyvrb"><a id="x20-71017r8"></a>8  <span id="textcolor852">void</span> <span id="textcolor853">print_arguments</span>(<span id="textcolor854">int</span> argc, <span id="textcolor855">char</span> ⋆argv[])<br class="fancyvrb"><a id="x20-71019r9"></a>9  {<br class="fancyvrb"><a id="x20-71021r10"></a>10      <span id="textcolor856">int</span> i = <span id="textcolor857">0</span>;<br class="fancyvrb"><a id="x20-71023r11"></a>11  
<br class="fancyvrb"><a id="x20-71025r12"></a>12      <span id="textcolor858">for</span>(i = <span id="textcolor859">0</span>; i <a id="x20-71027r13"></a>13          print_letters(argv[i]);
<br class="fancyvrb"><a id="x20-71029r14"></a>14      }<br class="fancyvrb"><a id="x20-71031r15"></a>15  }<br class="fancyvrb"><a id="x20-71033r16"></a>16  <br class="fancyvrb"><a id="x20-71035r17"></a>17  <span id="textcolor860">void</span> <span id="textcolor861">print_letters</span>(<span id="textcolor862">char</span> arg[])<br class="fancyvrb"><a id="x20-71037r18"></a>18  {<br class="fancyvrb"><a id="x20-71039r19"></a>19      <span id="textcolor863">int</span> i = <span id="textcolor864">0</span>;<br class="fancyvrb"><a id="x20-71041r20"></a>20  
<br class="fancyvrb"><a id="x20-71043r21"></a>21      <span id="textcolor865">for</span>(i = <span id="textcolor866">0</span>; arg[i] != <span class="colorbox" id="colorbox867"><span id="textcolor868">’\0’</span></span>; i++) {<br class="fancyvrb"><a id="x20-71045r22"></a>22          <span id="textcolor869">char</span> ch = arg[i];<br class="fancyvrb"><a id="x20-71047r23"></a>23  
<br class="fancyvrb"><a id="x20-71049r24"></a>24          <span id="textcolor870">if</span>(can_print_it(ch)) {<br class="fancyvrb"><a id="x20-71051r25"></a>25              printf(<span class="colorbox" id="colorbox871"><span id="textcolor872">"</span></span><span class="colorbox" id="colorbox873"><span id="textcolor874">’%c’ == %d </span></span><span class="colorbox" id="colorbox875"><span id="textcolor876">"</span></span>, ch, ch);
<br class="fancyvrb"><a id="x20-71053r26"></a>26          }<br class="fancyvrb"><a id="x20-71055r27"></a>27      }<br class="fancyvrb"><a id="x20-71057r28"></a>28  <br class="fancyvrb"><a id="x20-71059r29"></a>29      printf(<span class="colorbox" id="colorbox877"><span id="textcolor878">"</span></span><span class="colorbox" id="colorbox879"><span id="textcolor880">\n</span></span><span class="colorbox" id="colorbox881"><span id="textcolor882">"</span></span>);<br class="fancyvrb"><a id="x20-71061r30"></a>30  }<br class="fancyvrb"><a id="x20-71063r31"></a>31  <br class="fancyvrb"><a id="x20-71065r32"></a>32  <span id="textcolor883">int</span> <span id="textcolor884">can_print_it</span>(<span id="textcolor885">char</span> ch)<br class="fancyvrb"><a id="x20-71067r33"></a>33  {
<br class="fancyvrb"><a id="x20-71069r34"></a>34      <span id="textcolor886">return</span> isalpha(ch) || isblank(ch);<br class="fancyvrb"><a id="x20-71071r35"></a>35  }<br class="fancyvrb"><a id="x20-71073r36"></a>36  <br class="fancyvrb"><a id="x20-71075r37"></a>37  <br class="fancyvrb"><a id="x20-71077r38"></a>38  <span id="textcolor887">int</span> <span id="textcolor888">main</span>(<span id="textcolor889">int</span> argc, <span id="textcolor890">char</span> ⋆argv[])
<br class="fancyvrb"><a id="x20-71079r39"></a>39  {<br class="fancyvrb"><a id="x20-71081r40"></a>40      print_arguments(argc, argv);<br class="fancyvrb"><a id="x20-71083r41"></a>41      <span id="textcolor891">return</span> <span id="textcolor892">0</span>;<br class="fancyvrb"><a id="x20-71085r42"></a>42  }</div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><!--l. 53--><p class="indent">    在这个例子中你创建了一个函数，用来打印属于“alpha(字母)”或者“blanks(空白符)”类型的字符和它们对应的 ASCII 码值。以下是代码详解：
     </p><dl class="description"><dt class="description">
ex14.c:2 </dt><dd class="description">为了能使用函数 isalpha 和 isblank, 我们需要包含一个新的头文件。
     </dd><dt class="description">
ex14.c:5-6 </dt><dd class="description">你可以在没有实际定义函数之前就告诉 C 你稍后会在程序中使用的函数。这就是“前置声明(forward declaration)”，它解决了在未定义函数之前就使用函数这个鸡生蛋还是蛋生鸡的问题。
     </dd><dt class="description">
ex14.c:8-15 </dt><dd class="description">定义函数 print_arguments, 用来打印由 main 函数接收到的参数数组的值。
     </dd><dt class="description">
ex14.c:17-30 </dt><dd class="description">定义下一个函数 print_letters, 它由 print_arguments 函数调用, 用来输出每个字母的字符值和它们的 ASCII 码值。
     </dd><dt class="description">
ex14.c:32-35 </dt><dd class="description">定义函数 can_print_it 用来给调用它的函数 print_letters
     返回一个真值（0 或者 1），由 <span class="obeylines-h"><span class="verb">isalpha(ch) || isblank(ch)</span></span>决定该值。
     </dd><dt class="description">
ex14.c:38-42 </dt><dd class="description">最后，main 函数调用了函数 print_arguments，整个函数调用链就从这里开始了。</dd></dl><!--l. 68--><p class="indent">    其实我没必要描述各个函数中的实际内容，因为这些都是你在之前的练习中遇到过的。你应该看到的是我用和定义 main 函数一样的方式定义了一些函数。唯一的不同是你需要提前告诉 C 那些还没有在文件中遇到但之后要使用的函数，也就是那些代码头部的“前置声明(forward declaration)”所做的事情。
                                                                  

                                                                  
    </p><h3 class="sectionHead"><span class="titlemark">15.1    </span> <a id="x20-7200015.1"></a>你应该看到的结果</h3>
<!--l. 75--><p class="noindent">要体验这个程序，你只需给它提供不同的参数即可，这些参数将被传递到你的函数里边。以下是我的演示：
                                                                  

                                                                  
<!--l. 77--></p><p class="indent">    <a id="x20-72001r38"></a></p><hr class="float"></hr><div class="float">
                                                                  

                                                                  
<div class="caption"><span class="id">Source 38: </span><span class="content">                                                                                                      ex14 的输出</span></div><!--tex4ht:label?: x20-72001r38 -->
<!--l. 78-->
<div class="lstlisting" id="listing-25"><span class="label"><a id="x20-72002r1"></a>1</span>$ make ex14 <br><span class="label"><a id="x20-72003r2"></a>2</span>cc -Wall -g    ex14.c   -o ex14 <br><span class="label"><a id="x20-72004r3"></a>3</span> <br><span class="label"><a id="x20-72005r4"></a>4</span>$ ./ex14 <br><span class="label"><a id="x20-72006r5"></a>5</span>’e’ == 101 ’x’ == 120 <br><span class="label"><a id="x20-72007r6"></a>6</span> <br><span class="label"><a id="x20-72008r7"></a>7</span>$ ./ex14 hi this is cool <br><span class="label"><a id="x20-72009r8"></a>8</span>’e’ == 101 ’x’ == 120 <br><span class="label"><a id="x20-72010r9"></a>9</span>’h’ == 104 ’i’ == 105 <br><span class="label"><a id="x20-72011r10"></a>10</span>’t’ == 116 ’h’ == 104 ’i’ == 105 ’s’ == 115 <br><span class="label"><a id="x20-72012r11"></a>11</span>’i’ == 105 ’s’ == 115 <br><span class="label"><a id="x20-72013r12"></a>12</span>’c’ == 99 ’o’ == 111 ’o’ == 111 ’l’ == 108 <br><span class="label"><a id="x20-72014r13"></a>13</span> <br><span class="label"><a id="x20-72015r14"></a>14</span>$ ./ex14 "I go 3 spaces" <br><span class="label"><a id="x20-72016r15"></a>15</span>’e’ == 101 ’x’ == 120 <br><span class="label"><a id="x20-72017r16"></a>16</span>’I’ == 73 ’ ’ == 32 ’g’ == 103 ’o’ == 111 ’ ’ == 32 ’ ’ == 32 ’s’ == 115 ’p’ == 112 ’a’ == 97 ’c’ == 99 ’e’ == 101 ’s’ == 115 <br><span class="label"><a id="x20-72018r17"></a>17</span>$
</div>
                                                                  

                                                                  
    </div><hr class="endfloat"></hr><!--l. 100--><p class="indent">    函数 isalpha 和 isblank 所做的工作就是来判断一个输入的字符是否是字母(letter)
或者空白符(blank)。我最后一个示例中它打印了除了’3’ 以外的所有字符，因为’3’ 是一个数字<span class="footnote-mark"><a href="#fn1x16" id="fn1x16-bk"><sup class="textsuperscript">1</sup></a></span><a id="x20-72021f1"></a>。
    </p><h3 class="sectionHead"><span class="titlemark">15.2    </span> <a id="x20-7300015.2"></a>让程序出错</h3>
<!--l. 105--><p class="noindent">有两种不同的方式来破坏这个程序:
     </p><ol class="enumerate1"><li class="enumerate" id="x20-73002x1">把前置声明去除以此来迷惑编译器，它将会抱怨找不到函数 can_print_it 和 print_letters。
     </li>
     <li class="enumerate" id="x20-73004x2">当你在 main 函数中调用 print_arguments 时对 argc 加 1，这样就越过了 argv 数组的最后一个参数<span class="footnote-mark"><a href="#fn2x16" id="fn2x16-bk"><sup class="textsuperscript">2</sup></a></span><a id="x20-73005f2"></a>。
     </li></ol><!--l. 112--><p class="noindent">
    </p><h3 class="sectionHead"><span class="titlemark">15.3    </span> <a id="x20-7400015.3"></a>加分习题</h3>
<!--l. 114--><p class="noindent">
     </p><ol class="enumerate1"><li class="enumerate" id="x20-74002x1">重构这些代码似的你能使用更少的函数完成相同的工作。比如，你真的需要 can_print_it 这个函数吗？
     </li>
     <li class="enumerate" id="x20-74004x2">让 print_arguments 函数调用 strlen 函数来获知每个字符串参数的长度，然后把长度作为参数传递给 print_letters。然后重写 print_letters 函数使它只处理这个固定长度的字符串，这样就不需要依赖于 <span class="obeylines-h"><span class="verb">’\0’</span></span>来决定字符串长度了。
                                                                  

                                                                  
     </li>
     <li class="enumerate" id="x20-74006x3">使用 man 来查询 isalpha 和 isblank 函数的信息。用其他类似的函数来实现只打印数字或其他字符的功能。<span class="footnote-mark"><a href="#fn3x16" id="fn3x16-bk"><sup class="textsuperscript">3</sup></a></span><a id="x20-74007f3"></a>。
     </li>
     <li class="enumerate" id="x20-74009x4">去看看不同的人们格式化函数的不同风格。不要使用“K&amp;R 语法”，这是一种过时也是让人迷惑的方式。不过你要了解这种风格的成因，这样等你碰到喜欢这种风格的人，你就知道他们为什么喜欢了。</li></ol><!--l. 1--><p class="noindent">﻿</p><div class="footnotes"><!--l. 101--><p class="indent">  <span class="footnote-mark"><a href="#fn1x16-bk" id="fn1x16"><sup class="textsuperscript">1</sup></a></span>译者注：这里的 3 是指数字 3 而不是 ASCII 表中的字符’3’
<!--l. 108--></p><p class="noindent"><span class="footnote-mark"><a href="#fn2x16-bk" id="fn2x16"><sup class="textsuperscript">2</sup></a></span>译者注：这时候函数 print_arguments 函数最后将会访问越界
<!--l. 121--></p><p class="noindent"><span class="footnote-mark"><a href="#fn3x16-bk" id="fn3x16"><sup class="textsuperscript">3</sup></a></span>译者注：man 程序是 Unix 和类 Unix 系统上一个软件文档描述程序，使用它可以用来查询库函数等信息。通常在控制台执行。                             </p></div><!--l. 1--><div class="crosslinks"><p class="noindent">[<a href="learn-c-the-hard-waych16.html">next</a>]
[<a href="learn-c-the-hard-waych14.html">prev</a>] [<a href="learn-c-the-hard-waych14.html#taillearn-c-the-hard-waych14.html">prev-tail</a>] [<a href="learn-c-the-hard-waych15.html">front</a>] [<a href="learn-c-the-hard-waypa1.html#learn-c-the-hard-waych15.html">up</a>] </p></div>
<!--l. 1--><p class="indent">    <a id="taillearn-c-the-hard-waych15.html"></a>   
</p></body></html>